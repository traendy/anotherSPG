# Trying code-maat with git

Your code smells and you have no idea where the most disgusting stuff is hidden?
Code-maat tries to help you to find the best place to start by mining your version control data.

To use code-maat you need leiningen fist.

`brew install leiningen`

After that you want to checkout the repository to a directory of your choice:

```
git clone https://github.com/adamtornhill/code-maat.git
```

Finally you can compile the project via:

```
lein uberjar
```

This will generate two jars `code-maat-1.1-SNAPSHOT.jar` and `code-maat-1.1-SNAPSHOT-standalone.jar`

So code-maat is ready to use but your repository needs some preparation.

You need to run the following command to generate a nice logfile. Replace the date in the end to set the earliest date when the logs should be generated.

```
git log --all --numstat --date=short --pretty=format:'--%h--%ad--%aN' --no-renames --after=YYYY-MM-DD > logfile.log
git log --all --numstat --date=short --pretty=format:'--%h--%ad--%aN' --no-renames --after=2019-09-30 > logfile.log
```

You can invest some time and look into it. You may learn something.

If you are done you can start analyzing the logfile with code-maat.

```
java -jar code-maat-1.1-SNAPSHOT-standalone.jar -l logfile.log -c git2 > first.csv
```

The result is a table of files number of authors and number of revisions or changes to this file.

Files with many changes in the given time period are of higher interest for you if you want to invest time in code improvements.
Therfore files with little changes are so far stable. There either has not been any bug or no interesst in new features thus no benefit in updating it now.

You can already get some information but this might be overwhelming. So we better generate a summary now.

```
java -jar code-maat-1.1-SNAPSHOT-standalone.jar -l logfile.log -c git2 -a summary> summary.csv
```

The generated csv has some interessting informations for you. I used it on my logfile and got this:

|statistic|value|
|----|-----|
|number-of-commits|5406|
|number-of-entities|3302|
|number-of-entities-changed|23554|
|number-of-authors|15|

Its a time span of 2 years for a perspective.

Another insightful experience is logical coupling. Which means files that are often changed together.
This can be invoked by:
```
java -jar code-maat-1.1-SNAPSHOT-standalone.jar -l logfile.log -c git2 -a coupling > coupling.csv
```

The csv contains the columns entitiy, coupled, degree and average-revs.
The first two are clear the third one is the degree of coupling in percent.
So this means an entity has a degree (in percont) of risk that if it is changed its coupled entity will change as well.
"Since there's probably no reason they should change together, the analysis points to a part of the code worth investigating as a potential target for a future refactoring."

If you follow the belive that old code is more stable then newer code (which is the common belive) the following command tells you which files were not touched the longest (in months)

```
java -jar code-maat-1.1-SNAPSHOT-standalone.jar -l logfile.log -c git2 -a age > age.csv
```

Code churn says modules with a higher churn tend to have more defects. So it may be interessting when many files where added/deleted in some modules.

```
java -jar code-maat-1.1-SNAPSHOT-standalone.jar -l logfile.log -c git2 -a abs-churn > abs-churn.csv
```

This can also be generated by author so you can see who adds or deletes the most lines.

```
java -jar code-maat-1.1-SNAPSHOT-standalone.jar -l logfile.log -c git2 -a author-churn > author-churn.csv
```

Or entity

```
java -jar code-maat-1.1-SNAPSHOT-standalone.jar -l logfile.log -c git2 -a entity-churn > entity-churn.csv
```

Sometimes you want to see if knowledge of the code base is evenly distributed. This can be achieved by finding the author that contributed the most to an entity.

```
java -jar code-maat-1.1-SNAPSHOT-standalone.jar -l logfile.log -c git2 -a entity-ownership > entity-ownership.csv
```

Last but not least you may want to know who is the most viable person to refactor a given entity. 

```
java -jar code-maat-1.1-SNAPSHOT-standalone.jar -l logfile.log -c git2 -a entity-effort > entity-effort.csv
```

Source: https://github.com/adamtornhill/code-maat